{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container-fluid px-4 py-4" x-data="summarizerApp()" x-init="init()">
    {% csrf_token %}

    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h1 class="h2 fw-bold">{{ g.i18n.summarizer|default:"Summarizer" }}</h1>
            <p class="text-muted">{{ g.i18n.summarizer_desc|default:"Condense articles, papers, and documents into concise summaries" }}</p>
        </div>
    </div>

    <!-- Controls Bar -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body py-2 d-flex flex-wrap align-items-center justify-content-between gap-3">
                    <!-- Mode toggle -->
                    <div class="d-flex align-items-center gap-2">
                        <label class="small text-muted mb-0">Mode:</label>
                        <div class="btn-group btn-group-sm" role="group">
                            <button
                                type="button"
                                class="btn"
                                :class="mode === 'key_sentences' ? 'btn-primary' : 'btn-outline-secondary'"
                                @click="mode = 'key_sentences'"
                            >
                                Key Sentences
                            </button>
                            <button
                                type="button"
                                class="btn"
                                :class="mode === 'paragraph' ? 'btn-primary' : 'btn-outline-secondary'"
                                @click="mode = 'paragraph'"
                            >
                                Paragraph
                            </button>
                            {% if is_premium %}
                            <button
                                type="button"
                                class="btn"
                                :class="mode === 'custom' ? 'btn-primary' : 'btn-outline-secondary'"
                                @click="mode = 'custom'"
                            >
                                Custom <span class="badge bg-warning text-dark ms-1" style="font-size: 0.65em;">PRO</span>
                            </button>
                            {% else %}
                            <button
                                type="button"
                                class="btn btn-outline-secondary"
                                @click="showUpgradeForCustom()"
                                title="Premium feature"
                            >
                                Custom <span class="badge bg-warning text-dark ms-1" style="font-size: 0.65em;">PRO</span>
                            </button>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Summary length slider -->
                    <div class="d-flex align-items-center gap-2 flex-grow-1" style="max-width: 300px;">
                        <label class="small text-muted mb-0 text-nowrap">Length:</label>
                        <span class="small text-muted">Short</span>
                        <input
                            type="range"
                            class="form-range flex-grow-1"
                            min="1" max="5" step="1"
                            x-model="summaryLength"
                            style="max-width: 150px;"
                        >
                        <span class="small text-muted">Long</span>
                        <span class="badge bg-light text-dark" x-text="summaryLength"></span>
                    </div>

                    <!-- Bullet toggle (key_sentences mode) -->
                    <div class="d-flex align-items-center gap-2" x-show="mode === 'key_sentences'">
                        <label class="small text-muted mb-0">Bullets:</label>
                        <div class="form-check form-switch mb-0">
                            <input class="form-check-input" type="checkbox" x-model="showBullets" id="bulletToggle">
                        </div>
                    </div>

                    <!-- Word limit -->
                    <div class="text-end">
                        <span class="text-muted small" x-text="inputWordCount + ' / {{ word_limit }} words'"></span>
                        {% if not is_premium %}
                        <a href="/pricing/" class="btn btn-sm btn-outline-primary ms-2">Upgrade</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Instructions (shown only in custom mode) -->
    <div class="row mb-3" x-show="mode === 'custom'" x-transition>
        <div class="col-12">
            <div class="card shadow-sm border-primary">
                <div class="card-body py-3">
                    <label class="form-label fw-semibold mb-2">
                        Custom Instructions
                        <span class="badge bg-warning text-dark ms-1">PRO</span>
                    </label>
                    <textarea
                        x-model="customInstructions"
                        class="form-control"
                        rows="2"
                        placeholder="e.g., Summarize as bullet points, Focus on financial data, Write in first person, Extract action items..."
                        style="resize: vertical;"
                    ></textarea>
                    <small class="text-muted mt-1 d-block">Tell the AI exactly how you want your summary formatted or what to focus on.</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Keyword Focus -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body py-2">
                    <div class="d-flex align-items-start gap-2">
                        <label class="small text-muted mb-0 pt-1 text-nowrap">Keywords:</label>
                        <div class="flex-grow-1">
                            <div class="d-flex flex-wrap gap-1 align-items-center">
                                <template x-for="(keyword, idx) in keywords" :key="idx">
                                    <span class="badge bg-primary d-flex align-items-center gap-1 py-1 px-2">
                                        <span x-text="keyword"></span>
                                        <button type="button" class="btn-close btn-close-white" style="font-size: 0.5em;" @click="removeKeyword(idx)"></button>
                                    </span>
                                </template>
                                <input
                                    type="text"
                                    class="border-0 flex-grow-1"
                                    style="min-width: 120px; outline: none; font-size: 0.875rem;"
                                    placeholder="Type a keyword and press Enter..."
                                    x-model="keywordInput"
                                    @keydown.enter.prevent="addKeyword()"
                                    @keydown.comma.prevent="addKeyword()"
                                    @keydown.backspace="if (!keywordInput && keywords.length) removeKeyword(keywords.length - 1)"
                                >
                            </div>
                            <small class="text-muted" x-show="keywords.length === 0">Add keywords to emphasize specific topics in the summary (press Enter to add)</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Two-panel layout -->
    <div class="row">
        <!-- Input Panel -->
        <div class="col-12 col-lg-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <span class="fw-semibold">{{ g.i18n.original_text|default:"Original Text" }}</span>
                    <button
                        @click="clearInput()"
                        class="btn btn-sm btn-outline-secondary"
                        x-show="text.length > 0"
                    >Clear</button>
                </div>
                <div class="card-body p-0">
                    <textarea
                        x-model="text"
                        @input="updateWordCount()"
                        class="form-control border-0"
                        style="min-height: 400px; resize: vertical; font-size: 1rem; line-height: 1.6;"
                        :placeholder="'{{ g.i18n.summarizer_placeholder|default:"Paste the text you want to summarize here..." }}'"
                    ></textarea>
                </div>
                <div class="card-footer bg-white border-top d-flex justify-content-between align-items-center">
                    <span class="small text-muted" x-text="inputWordCount + ' words'"></span>
                    <button
                        @click="summarize()"
                        :disabled="loading || !text.trim()"
                        class="btn btn-primary"
                    >
                        <span x-show="loading" class="spinner-border spinner-border-sm me-1"></span>
                        <span x-text="loading ? 'Summarizing...' : '{{ g.i18n.summarize|default:"Summarize" }}'"></span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Output Panel -->
        <div class="col-12 col-lg-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <span class="fw-semibold">{{ g.i18n.summary|default:"Summary" }}</span>
                    <button
                        @click="copySummary()"
                        class="btn btn-sm btn-outline-secondary"
                        x-show="summary.length > 0"
                    >
                        <span x-text="copied ? 'Copied!' : 'Copy'"></span>
                    </button>
                </div>
                <div class="card-body" style="min-height: 400px;">
                    <template x-if="!summary && !loading">
                        <div class="d-flex align-items-center justify-content-center h-100 text-muted">
                            <p>Your summary will appear here</p>
                        </div>
                    </template>

                    <template x-if="loading">
                        <div class="d-flex align-items-center justify-content-center h-100">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                    </template>

                    <!-- Key sentences output -->
                    <template x-if="summary && mode === 'key_sentences' && sentences.length > 0">
                        <div>
                            <template x-if="showBullets">
                                <ul class="mb-0" style="line-height: 1.8;">
                                    <template x-for="(sentence, idx) in sentences" :key="idx">
                                        <li class="mb-2" x-text="sentence"></li>
                                    </template>
                                </ul>
                            </template>
                            <template x-if="!showBullets">
                                <div style="line-height: 1.8;">
                                    <template x-for="(sentence, idx) in sentences" :key="idx">
                                        <p class="mb-2">
                                            <span class="badge bg-primary me-1" x-text="idx + 1"></span>
                                            <span x-text="sentence"></span>
                                        </p>
                                    </template>
                                </div>
                            </template>
                        </div>
                    </template>

                    <!-- Paragraph / Custom output -->
                    <template x-if="summary && (mode === 'paragraph' || mode === 'custom' || sentences.length === 0)">
                        <div style="line-height: 1.8; white-space: pre-wrap;" x-text="summary"></div>
                    </template>
                </div>
                <div class="card-footer bg-white border-top" x-show="stats.original_words > 0">
                    <div class="d-flex flex-wrap justify-content-between gap-2">
                        <div class="text-center">
                            <div class="small text-muted">Original</div>
                            <div class="fw-bold" x-text="stats.original_words + ' words'"></div>
                        </div>
                        <div class="text-center">
                            <div class="small text-muted">Summary</div>
                            <div class="fw-bold" x-text="stats.summary_words + ' words'"></div>
                        </div>
                        <div class="text-center">
                            <div class="small text-muted">Reduction</div>
                            <div class="fw-bold text-success" x-text="stats.reduction_percent + '%'"></div>
                        </div>
                        <div class="text-center">
                            <div class="small text-muted">Sentences</div>
                            <div class="fw-bold" x-text="stats.sentence_count"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Error alert -->
    <template x-if="errorMessage">
        <div class="row">
            <div class="col-12">
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <span x-text="errorMessage"></span>
                    <button type="button" class="btn-close" @click="errorMessage = null"></button>
                </div>
            </div>
        </div>
    </template>
</div>

<!-- Why Use Section -->
<div class="bg-light py-5">
    <div class="container">
        <h2 class="text-center fw-bold mb-5">Why Use Our Summarizer</h2>
        <div class="row g-4">
            <div class="col-md-4">
                <div class="card h-100 border-0 shadow-sm p-4">
                    <h5 class="fw-semibold mb-3">Multiple Summary Modes</h5>
                    <p class="text-muted mb-0">Choose between Key Sentences for bullet-point highlights, Paragraph for a flowing summary, or Custom mode (Premium) with your own instructions for exactly how you want your summary formatted.</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100 border-0 shadow-sm p-4">
                    <h5 class="fw-semibold mb-3">Adjustable Summary Length</h5>
                    <p class="text-muted mb-0">Fine-tune summary length from short to long with a simple slider. Get a concise overview or a detailed briefing depending on your needs.</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100 border-0 shadow-sm p-4">
                    <h5 class="fw-semibold mb-3">Keyword Focus</h5>
                    <p class="text-muted mb-0">Add keywords to emphasize specific topics in your summary. The AI prioritizes content related to your keywords, ensuring the summary covers what matters most to you.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- How to Use Section -->
<div class="container py-5">
    <h2 class="text-center fw-bold mb-5">How to Use Summarizer</h2>
    <div class="row g-4 justify-content-center">
        <div class="col-md-4 text-center">
            <div class="rounded-circle bg-primary text-white d-inline-flex align-items-center justify-content-center mb-3" style="width:48px;height:48px;font-size:1.25rem;font-weight:700;">1</div>
            <h5 class="fw-semibold">Paste Your Text</h5>
            <p class="text-muted">Enter the article, paper, or document you want to summarize. Add optional keywords to focus the summary on specific topics.</p>
        </div>
        <div class="col-md-4 text-center">
            <div class="rounded-circle bg-primary text-white d-inline-flex align-items-center justify-content-center mb-3" style="width:48px;height:48px;font-size:1.25rem;font-weight:700;">2</div>
            <h5 class="fw-semibold">Choose Mode & Length</h5>
            <p class="text-muted">Select Key Sentences, Paragraph, or Custom mode. Adjust the summary length slider from short to long.</p>
        </div>
        <div class="col-md-4 text-center">
            <div class="rounded-circle bg-primary text-white d-inline-flex align-items-center justify-content-center mb-3" style="width:48px;height:48px;font-size:1.25rem;font-weight:700;">3</div>
            <h5 class="fw-semibold">Get Your Summary</h5>
            <p class="text-muted">Click Summarize to generate your condensed text. View reduction statistics showing original vs. summary word count and percentage reduction.</p>
        </div>
    </div>
</div>

<!-- FAQ Section -->
<div class="container py-5">
    <h2 class="text-center fw-bold mb-5">Frequently Asked Questions</h2>
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="accordion" id="faqAccordion">
                <div class="accordion-item border-0 mb-2">
                    <h3 class="accordion-header">
                        <button class="accordion-button fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                            What is the difference between Key Sentences and Paragraph mode?
                        </button>
                    </h3>
                    <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                        <div class="accordion-body text-muted">
                            Key Sentences mode extracts the most important sentences from your text and presents them as numbered points or bullet points. Paragraph mode generates a new, flowing paragraph that captures the main ideas in a cohesive narrative. Choose Key Sentences for quick scanning and Paragraph for readable summaries.
                        </div>
                    </div>
                </div>
                <div class="accordion-item border-0 mb-2">
                    <h3 class="accordion-header">
                        <button class="accordion-button collapsed fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                            What is the word limit for summarization?
                        </button>
                    </h3>
                    <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body text-muted">
                            Free users can summarize up to 2,000 words per request. Premium subscribers get extended word limits for longer documents like research papers, reports, and book chapters.
                        </div>
                    </div>
                </div>
                <div class="accordion-item border-0 mb-2">
                    <h3 class="accordion-header">
                        <button class="accordion-button collapsed fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                            How does the keyword focus feature work?
                        </button>
                    </h3>
                    <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body text-muted">
                            When you add keywords, the AI gives extra weight to sentences and ideas related to those terms. For example, if you add "revenue" and "growth" as keywords for a business report, the summary will prioritize financial information over other topics.
                        </div>
                    </div>
                </div>
                <div class="accordion-item border-0 mb-2">
                    <h3 class="accordion-header">
                        <button class="accordion-button collapsed fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#faq4">
                            What does Custom mode do?
                        </button>
                    </h3>
                    <div id="faq4" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body text-muted">
                            Custom mode (Premium only) lets you give the AI specific instructions for how to generate the summary. For example, you can say "summarize as bullet points focusing on financial data" or "write a one-paragraph executive summary in formal tone."
                        </div>
                    </div>
                </div>
                <div class="accordion-item border-0 mb-2">
                    <h3 class="accordion-header">
                        <button class="accordion-button collapsed fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#faq5">
                            How accurate are the summaries?
                        </button>
                    </h3>
                    <div id="faq5" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body text-muted">
                            Our AI-powered summarizer captures the key ideas and main arguments from your text with high accuracy. However, we recommend reviewing the summary to ensure no critical details are missing, especially for academic or legal documents where precision is essential.
                        </div>
                    </div>
                </div>
                <div class="accordion-item border-0 mb-2">
                    <h3 class="accordion-header">
                        <button class="accordion-button collapsed fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#faq6">
                            Can I summarize PDFs or uploaded documents?
                        </button>
                    </h3>
                    <div id="faq6" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body text-muted">
                            Currently, the summarizer works with pasted text. For PDF documents, you can use our PDF tools to extract text first, then paste it into the summarizer. We are working on direct file upload support.
                        </div>
                    </div>
                </div>
                <div class="accordion-item border-0 mb-2">
                    <h3 class="accordion-header">
                        <button class="accordion-button collapsed fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#faq7">
                            What is the reduction percentage?
                        </button>
                    </h3>
                    <div id="faq7" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body text-muted">
                            The reduction percentage shows how much shorter the summary is compared to the original text. For example, if a 1,000-word article is summarized into 200 words, the reduction is 80%. Higher reduction means a more concise summary.
                        </div>
                    </div>
                </div>
                <div class="accordion-item border-0 mb-2">
                    <h3 class="accordion-header">
                        <button class="accordion-button collapsed fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#faq8">
                            Does it work with academic papers?
                        </button>
                    </h3>
                    <div id="faq8" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body text-muted">
                            Yes. The summarizer handles academic papers, research articles, and technical documents well. Use keywords to focus on specific aspects of the paper, like methodology, findings, or conclusions.
                        </div>
                    </div>
                </div>
                <div class="accordion-item border-0 mb-2">
                    <h3 class="accordion-header">
                        <button class="accordion-button collapsed fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#faq9">
                            Can I use bullet points in Key Sentences mode?
                        </button>
                    </h3>
                    <div id="faq9" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body text-muted">
                            Yes. In Key Sentences mode, toggle the Bullets switch to display the key sentences as a bulleted list instead of numbered points. This is useful for presentations and meeting notes.
                        </div>
                    </div>
                </div>
                <div class="accordion-item border-0 mb-2">
                    <h3 class="accordion-header">
                        <button class="accordion-button collapsed fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#faq10">
                            Is the summarizer free?
                        </button>
                    </h3>
                    <div id="faq10" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body text-muted">
                            Yes, the summarizer is free for all users with standard word limits. The Custom mode with personalized instructions is a Premium feature. No account is required for basic summarization.
                        </div>
                    </div>
                </div>
                <div class="accordion-item border-0 mb-2">
                    <h3 class="accordion-header">
                        <button class="accordion-button collapsed fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#faq11">
                            Does it support languages other than English?
                        </button>
                    </h3>
                    <div id="faq11" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body text-muted">
                            The summarizer works best with English text. It may produce acceptable results for other languages, but the AI is optimized for English grammar and context. For non-English text, consider translating first using our translator tool.
                        </div>
                    </div>
                </div>
                <div class="accordion-item border-0 mb-2">
                    <h3 class="accordion-header">
                        <button class="accordion-button collapsed fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#faq12">
                            How is this different from ChatGPT summarization?
                        </button>
                    </h3>
                    <div id="faq12" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body text-muted">
                            Our summarizer is purpose-built for summarization with features like keyword focus, adjustable length, Key Sentences vs. Paragraph modes, and reduction statistics. It provides a dedicated, optimized experience compared to using a general-purpose chatbot for summarization.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/summarizer.js' %}?v={{ g.scripts_version }}"></script>
{% endblock %}
