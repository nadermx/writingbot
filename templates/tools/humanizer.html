{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container py-4">
    <div class="text-center mb-4">
        <h1 class="display-5 fw-bold">AI Humanizer</h1>
        <p class="lead text-muted">Transform AI-generated text into natural, human-sounding writing</p>
    </div>

    {% csrf_token %}

    <div x-data="humanizer()" x-cloak>
        <!-- Mode Toggle -->
        <div class="row justify-content-center mb-3">
            <div class="col-lg-10">
                <div class="d-flex justify-content-center">
                    <div class="btn-group" role="group">
                        <button
                            type="button"
                            class="btn px-4"
                            :class="mode === 'basic' ? 'btn-primary' : 'btn-outline-primary'"
                            @click="mode = 'basic'"
                        >
                            Basic <span class="badge bg-light text-primary ms-1">Free</span>
                        </button>
                        <button
                            type="button"
                            class="btn px-4"
                            :class="mode === 'advanced' ? 'btn-primary' : 'btn-outline-primary'"
                            @click="mode = 'advanced'"
                        >
                            Advanced
                            {% if not is_premium %}
                            <span class="badge bg-warning text-dark ms-1">Premium</span>
                            {% endif %}
                        </button>
                    </div>
                </div>
                <p class="text-center text-muted small mt-2" x-text="mode === 'basic' ? 'Light touch - fixes obvious AI patterns while keeping your text close to the original' : 'Deep rewrite - varying sentence structure, adding personal touches, natural flow'"></p>
            </div>
        </div>

        <!-- Split Pane -->
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="row g-3">
                    <!-- Input -->
                    <div class="col-md-6">
                        <div class="card shadow-sm h-100">
                            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                                <span class="fw-semibold">Original Text</span>
                                <small class="text-muted">
                                    <span x-text="wordCount"></span> words
                                    {% if not is_premium %}
                                    <span class="text-muted">/ 500 max</span>
                                    {% endif %}
                                </small>
                            </div>
                            <div class="card-body p-0">
                                <textarea
                                    class="form-control border-0"
                                    rows="14"
                                    x-model="inputText"
                                    @input="updateWordCount()"
                                    placeholder="Paste your AI-generated text here..."
                                    style="resize: none; font-size: 15px; line-height: 1.7; border-radius: 0 0 0.375rem 0.375rem;"
                                ></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Output -->
                    <div class="col-md-6">
                        <div class="card shadow-sm h-100">
                            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                                <span class="fw-semibold">Humanized Text</span>
                                <button
                                    class="btn btn-sm btn-outline-secondary"
                                    @click="copyOutput()"
                                    x-show="outputText.length > 0"
                                    :title="copied ? 'Copied!' : 'Copy to clipboard'"
                                >
                                    <span x-show="!copied">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16"><path d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1H2z"/></svg>
                                        Copy
                                    </span>
                                    <span x-show="copied">Copied!</span>
                                </button>
                            </div>
                            <div class="card-body" style="min-height: 320px;">
                                <div x-show="!outputText && !loading" class="text-muted text-center py-5">
                                    <p>Humanized text will appear here</p>
                                </div>
                                <div x-show="loading" class="text-center py-5">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Humanizing...</span>
                                    </div>
                                    <p class="text-muted mt-2">Humanizing your text...</p>
                                </div>
                                <div x-show="outputText && !loading" style="font-size: 15px; line-height: 1.7; white-space: pre-wrap;" x-text="outputText"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Bar -->
        <div class="row justify-content-center mt-3">
            <div class="col-lg-10">
                <div class="d-flex justify-content-between align-items-center">
                    <button
                        class="btn btn-primary btn-lg px-5"
                        @click="humanize()"
                        :disabled="loading || wordCount === 0"
                    >
                        <span x-show="!loading">Humanize</span>
                        <span x-show="loading">
                            <span class="spinner-border spinner-border-sm me-1" role="status"></span>
                            Processing...
                        </span>
                    </button>
                    <button
                        class="btn btn-outline-secondary"
                        @click="clearAll()"
                        x-show="inputText.length > 0"
                    >Clear</button>
                </div>

                <!-- Error -->
                <div x-show="error" class="alert alert-danger mt-3 mb-0" x-text="error"></div>
            </div>
        </div>

        <!-- AI Score Comparison -->
        <div x-show="hasResults" class="row justify-content-center mt-4">
            <div class="col-lg-10">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="fw-semibold text-center mb-4">AI Detection Score</h5>
                        <div class="row text-center">
                            <div class="col-md-5">
                                <div class="position-relative d-inline-block" style="width: 130px; height: 130px;">
                                    <svg viewBox="0 0 120 120" class="w-100 h-100">
                                        <circle cx="60" cy="60" r="50" fill="none" stroke="#e9ecef" stroke-width="10"
                                            stroke-dasharray="235.6" stroke-dashoffset="0"
                                            transform="rotate(-90 60 60)" stroke-linecap="round"/>
                                        <circle cx="60" cy="60" r="50" fill="none"
                                            :stroke="getScoreColor(aiScoreBefore)" stroke-width="10"
                                            stroke-dasharray="235.6"
                                            :stroke-dashoffset="235.6 - (235.6 * (aiScoreBefore / 100))"
                                            transform="rotate(-90 60 60)" stroke-linecap="round"
                                            style="transition: stroke-dashoffset 1s ease-in-out;"/>
                                    </svg>
                                    <div class="position-absolute top-50 start-50 translate-middle text-center">
                                        <span class="fs-3 fw-bold" :style="'color:' + getScoreColor(aiScoreBefore)" x-text="aiScoreBefore + '%'"></span>
                                    </div>
                                </div>
                                <p class="text-muted mt-2">Before</p>
                            </div>
                            <div class="col-md-2 d-flex align-items-center justify-content-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="text-primary" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
                                </svg>
                            </div>
                            <div class="col-md-5">
                                <div class="position-relative d-inline-block" style="width: 130px; height: 130px;">
                                    <svg viewBox="0 0 120 120" class="w-100 h-100">
                                        <circle cx="60" cy="60" r="50" fill="none" stroke="#e9ecef" stroke-width="10"
                                            stroke-dasharray="235.6" stroke-dashoffset="0"
                                            transform="rotate(-90 60 60)" stroke-linecap="round"/>
                                        <circle cx="60" cy="60" r="50" fill="none"
                                            :stroke="getScoreColor(aiScoreAfter)" stroke-width="10"
                                            stroke-dasharray="235.6"
                                            :stroke-dashoffset="235.6 - (235.6 * (aiScoreAfter / 100))"
                                            transform="rotate(-90 60 60)" stroke-linecap="round"
                                            style="transition: stroke-dashoffset 1s ease-in-out;"/>
                                    </svg>
                                    <div class="position-absolute top-50 start-50 translate-middle text-center">
                                        <span class="fs-3 fw-bold" :style="'color:' + getScoreColor(aiScoreAfter)" x-text="aiScoreAfter + '%'"></span>
                                    </div>
                                </div>
                                <p class="text-muted mt-2">After</p>
                            </div>
                        </div>
                        <div class="text-center mt-2">
                            <span class="badge bg-success fs-6 px-3 py-2" x-show="aiScoreBefore - aiScoreAfter > 0">
                                <span x-text="Math.round(aiScoreBefore - aiScoreAfter)"></span>% reduction in AI detection
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/alpinejs@3/dist/cdn.min.js" defer></script>
<script src="{% static 'js/humanizer.js' %}?v={{ g.scripts_version }}"></script>
{% endblock %}
