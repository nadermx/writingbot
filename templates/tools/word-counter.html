{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container-fluid px-4 py-4" x-data="wordCounterApp()" x-init="init()">

    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h1 class="h2 fw-bold">{{ g.i18n.word_counter|default:"Word Counter" }}</h1>
            <p class="text-muted">{{ g.i18n.word_counter_desc|default:"Count words, characters, sentences, and more in real time" }}</p>
        </div>
    </div>

    <!-- Main Stats Bar -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body py-2">
                    <div class="d-flex flex-wrap justify-content-center gap-4">
                        <div class="text-center">
                            <div class="h4 fw-bold mb-0 text-primary" x-text="words"></div>
                            <div class="small text-muted">Words</div>
                        </div>
                        <div class="text-center">
                            <div class="h4 fw-bold mb-0 text-primary" x-text="characters"></div>
                            <div class="small text-muted">Characters</div>
                        </div>
                        <div class="text-center">
                            <div class="h4 fw-bold mb-0 text-primary" x-text="charactersNoSpaces"></div>
                            <div class="small text-muted">Characters (no spaces)</div>
                        </div>
                        <div class="text-center">
                            <div class="h4 fw-bold mb-0 text-primary" x-text="sentenceCount"></div>
                            <div class="small text-muted">Sentences</div>
                        </div>
                        <div class="text-center">
                            <div class="h4 fw-bold mb-0 text-primary" x-text="paragraphCount"></div>
                            <div class="small text-muted">Paragraphs</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Text Area -->
        <div class="col-12 col-lg-8 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <span class="fw-semibold">{{ g.i18n.your_text|default:"Your Text" }}</span>
                    <button
                        @click="clearText()"
                        class="btn btn-sm btn-outline-secondary"
                        x-show="text.length > 0"
                    >Clear</button>
                </div>
                <div class="card-body p-0">
                    <textarea
                        x-model="text"
                        @input="analyze()"
                        class="form-control border-0"
                        style="min-height: 500px; resize: vertical; font-size: 1rem; line-height: 1.6;"
                        placeholder="{{ g.i18n.word_counter_placeholder|default:'Type or paste your text here to see detailed statistics...' }}"
                    ></textarea>
                </div>
            </div>
        </div>

        <!-- Stats Sidebar -->
        <div class="col-12 col-lg-4 mb-4">
            <!-- Reading & Speaking Time -->
            <div class="card shadow-sm mb-3">
                <div class="card-header bg-white fw-semibold">Time Estimates</div>
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-2">
                        <span class="text-muted">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="me-1" viewBox="0 0 16 16">
                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1H8a.5.5 0 0 1-.5-.5v-3.5A.5.5 0 0 1 8 4z"/>
                            </svg>
                            Reading Time
                        </span>
                        <span class="fw-semibold" x-text="readingTime"></span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span class="text-muted">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="me-1" viewBox="0 0 16 16">
                                <path d="M8 3a5 5 0 0 0-5 5v1h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V8a6 6 0 1 1 12 0v5a1 1 0 0 1-1 1h-1a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1V8a5 5 0 0 0-5-5z"/>
                            </svg>
                            Speaking Time
                        </span>
                        <span class="fw-semibold" x-text="speakingTime"></span>
                    </div>
                </div>
            </div>

            <!-- Readability Score -->
            <div class="card shadow-sm mb-3">
                <div class="card-header bg-white fw-semibold">Readability</div>
                <div class="card-body text-center">
                    <div class="position-relative d-inline-flex align-items-center justify-content-center mb-2" style="width: 100px; height: 100px;">
                        <svg width="100" height="100" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="42" fill="none" stroke="#e9ecef" stroke-width="6"/>
                            <circle
                                cx="50" cy="50" r="42" fill="none"
                                :stroke="getReadabilityColor()"
                                stroke-width="6"
                                stroke-linecap="round"
                                :stroke-dasharray="(2 * Math.PI * 42)"
                                :stroke-dashoffset="(2 * Math.PI * 42) * (1 - Math.max(0, Math.min(100, readabilityScore)) / 100)"
                                transform="rotate(-90 50 50)"
                                style="transition: stroke-dashoffset 0.4s ease;"
                            />
                        </svg>
                        <span class="position-absolute fw-bold h5 mb-0" x-text="readabilityScore"></span>
                    </div>
                    <div class="fw-semibold" x-text="readabilityLabel"></div>
                    <div class="small text-muted">Flesch-Kincaid Reading Ease</div>
                </div>
            </div>

            <!-- Top Keywords -->
            <div class="card shadow-sm">
                <div class="card-header bg-white fw-semibold">Top Keywords</div>
                <div class="card-body p-0">
                    <template x-if="keywords.length === 0">
                        <p class="text-muted text-center small p-3 mb-0">Start typing to see keyword density</p>
                    </template>
                    <table class="table table-sm mb-0" x-show="keywords.length > 0">
                        <thead class="table-light">
                            <tr>
                                <th class="small">Keyword</th>
                                <th class="small text-center">Count</th>
                                <th class="small text-end">Density</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="(kw, idx) in keywords" :key="idx">
                                <tr>
                                    <td>
                                        <span class="small" x-text="kw.word"></span>
                                    </td>
                                    <td class="text-center">
                                        <span class="small" x-text="kw.count"></span>
                                    </td>
                                    <td class="text-end">
                                        <div class="d-flex align-items-center justify-content-end gap-1">
                                            <div class="progress flex-grow-1" style="height: 6px; max-width: 60px;">
                                                <div
                                                    class="progress-bar bg-primary"
                                                    :style="'width: ' + Math.min(kw.density * 10, 100) + '%'"
                                                ></div>
                                            </div>
                                            <span class="small" x-text="kw.density + '%'"></span>
                                        </div>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/word-counter.js' %}?v={{ g.scripts_version }}"></script>
{% endblock %}
